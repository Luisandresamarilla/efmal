<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Chat</title>
  </head>
  <body>
    <div id="chat-container">
      <div id="chat-messages"></div>
      <div id="chat-input">
        <input type="text" id="message-input" placeholder="Escribe tu mensaje...">
        <button id="send-button">Enviar</button>
      </div>
    </div>

    <script>
      // Obtener el nombre del participante
      let participantName = prompt('Ingresa tu nombre:');
      if (participantName === null || participantName.trim() === '') {
        participantName = 'Invitado'; // Si el usuario no ingresa un nombre, utilizar "Invitado" como nombre predeterminado
      }

      // Elementos del chat
      const chatMessages = document.getElementById('chat-messages');
      const messageInput = document.getElementById('message-input');
      const sendButton = document.getElementById('send-button');

      // Función para mostrar un mensaje en el chat
      function displayMessage(sender, content) {
        const messageElement = document.createElement('div');
        messageElement.textContent = sender + ': ' + content;
        chatMessages.appendChild(messageElement);
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }

      // Función para enviar un mensaje
      function sendMessage() {
        const messageContent = messageInput.value;

        // Validar que el mensaje no esté vacío
        if (messageContent.trim() === '') {
          return;
        }

        // Crear el objeto del mensaje
        const message = {
          sender: participantName,
          content: messageContent
        };

        // Realizar una petición POST a la API para enviar el mensaje
        fetch('https://chat-238d1-default-rtdb.firebaseio.com/Mensajes.json', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(message)
        })
          .then(response => {
            if (response.ok) {
              // Mostrar el mensaje en el chat
              displayMessage(participantName, messageContent);
              messageInput.value = ''; // Limpiar el campo de entrada de mensajes
            } else {
              console.error('Error al enviar el mensaje:', response.status);
            }
          })
          .catch(error => {
            console.error('Error al enviar el mensaje:', error);
          });
      }

      // Manejar el evento de clic en el botón de enviar
      sendButton.addEventListener('click', sendMessage);

      // Función para actualizar el chat sin recargar la página
      function updateChat() {
        // Obtener los mensajes existentes de la API y mostrarlos en el chat
        fetch('https://chat-238d1-default-rtdb.firebaseio.com/Mensajes.json')
          .then(response => response.json())
          .then(data => {
            // Limpiar el contenido actual del chat
            chatMessages.innerHTML = '';
            for (let key in data) {
              const message = data[key];
              displayMessage(message.sender, message.content);
            }
          })
          .catch(error => {
            console.error('Error al obtener los mensajes:', error);
          });
      }

      // Actualizar el chat cada 5 segundos (puedes ajustar el intervalo según tus necesidades)
      setInterval(updateChat, 5000);
    </script>
  </body>
</html>
